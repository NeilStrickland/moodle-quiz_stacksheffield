define ("quiz_stacksheffield/timeline_viewer",[],function(){return{attempt:{id:0,steps:null,num_steps:0,last_step:null},step:{t:0,id:0,fraction:0},pad:function(a){return(10>a?"0":"")+a},time_string:function(a){var b=a,c=Math.floor(b/86400);b-=3600*(24*c);var d=Math.floor(b/3600);b-=60*(60*d);var e=Math.floor(b/60);b-=60*e;var f=b;if(c){return""+c+":"+this.pad(d)+":"+this.pad(e)+":"+this.pad(f)+"s"}else if(d){return""+d+":"+this.pad(e)+":"+this.pad(f)+"s"}else if(e){return""+e+":"+this.pad(f)+"s"}else{return""+f+"s"}},add_attempt:function(b){var c=Object.create(this.attempt);c.steps=[];for(var a=1;a<=b.length;a++){var d=b[a-1],e=Object.create(this.step);e.i=a;e.t=d[0];e.quiz_attempt_id=d[1];e.slot=d[2];e.sequence_number=d[3];e.fraction=d[4];e.url="/moodle/mod/quiz/reviewquestion.php?attempt="+e.quiz_attempt_id+"&slot="+e.slot+"&step="+e.sequence_number;c.steps.push(e)}c.num_steps=c.steps.length;c.last_step=c.steps[c.steps.length-1];c.i=this.attempts.length;c.full_seconds=c.last_step.t;c.hours=Math.floor(c.full_seconds/3600);c.minutes=Math.floor((c.full_seconds-3600*c.hours)/60);c.seconds=c.full_seconds-3600*c.hours-60*c.minutes;if(c.hours){c.duration_string=c.hours+":"+(10>c.minutes?"0":"")+c.minutes+":"+(10>c.seconds?"0":"")+c.seconds}else if(c.minutes){c.duration_string=c.minutes+":"+(10>c.seconds?"0":"")+c.seconds}else{c.duration_string=""+c.seconds}if(1==c.num_steps){c.msg="One attempt; total duration "+this.time_string(c.last_step.t)+"."}else{c.msg=""+c.num_steps+" attempts; total duration "+this.time_string(c.last_step.t)+"."}for(var a=1,e;a<=c.num_steps;a++){e=c.steps[a-1];e.msg="Attempt "+a+"/"+c.num_steps+"; "+this.time_string(e.t)+" after first view";if(1<a){e.msg+="; "+this.time_string(e.t-c.steps[0].t)+" after first attempt"}if(2<a){e.msg+="; "+this.time_string(e.t-c.steps[a-2].t)+" after previous attempt"}e.msg+="."}this.attempts.push(c);return c},create_attempt_dom:function(b){var a=this;b.x0=b.last_step.t*this.w;b.x=b.x0;b.y=2*(b.i+2)*this.h;b.bar=document.createElementNS("http://www.w3.org/2000/svg","line");b.bar.setAttributeNS(null,"x1",0);b.bar.setAttributeNS(null,"y1",b.y);b.bar.setAttributeNS(null,"x2",b.x);b.bar.setAttributeNS(null,"y2",b.y);b.bar.setAttributeNS(null,"stroke",this.stroke_colour);b.bar.setAttributeNS(null,"stroke-width",this.stroke_width);b.bar.onmouseover=function(){a.show_msg(b.msg);b.bar.setAttributeNS(null,"stroke","#000000")};b.bar.onmouseout=function(){a.show_msg("");b.bar.setAttributeNS(null,"stroke",a.stroke_colour)};this.svg.appendChild(b.bar);for(var c in b.steps){var d=b.steps[c];this.create_step_dom(b,d)}},create_step_dom:function(b,a){var c=this;a.x0=a.t*this.w;a.x=a.x0;a.marker=document.createElementNS("http://www.w3.org/2000/svg","circle");a.marker.setAttributeNS(null,"cx",a.x);a.marker.setAttributeNS(null,"cy",b.y);a.marker.setAttributeNS(null,"r",this.marker_radius);if(1==a.fraction){a.inactive_colour=this.correct_colour;a.active_colour=this.active_correct_colour}else if(0==a.fraction){a.inactive_colour=this.incorrect_colour;a.active_colour=this.active_incorrect_colour}else{a.inactive_colour=this.iffy_colour;a.active_colour=this.active_iffy_colour}a.marker.setAttributeNS(null,"stroke",a.inactive_colour);a.marker.setAttributeNS(null,"fill",a.inactive_colour);a.marker.onmouseover=function(){c.show_msg(a.msg);a.marker.setAttributeNS(null,"stroke",a.active_colour);a.marker.setAttributeNS(null,"fill",a.active_colour)};a.marker.onmouseout=function(){c.show_msg("");a.marker.setAttributeNS(null,"stroke",a.inactive_colour);a.marker.setAttributeNS(null,"fill",a.inactive_colour)};a.marker.onclick=function(){window.open(a.url)};this.svg.appendChild(a.marker)},create_line:function(a,b){var c=this,d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttributeNS(null,"x1",this.w*a);d.setAttributeNS(null,"y1",0);d.setAttributeNS(null,"x2",this.w*a);d.setAttributeNS(null,"y2",b);if(0==a%600){d.setAttributeNS(null,"stroke","#0000DD");d.setAttributeNS(null,"stroke-width",3)}else{d.setAttributeNS(null,"stroke","#0000DD");d.setAttributeNS(null,"stroke-width",1);d.setAttributeNS(null,"stroke-dasharray","2,2")}d.onmouseover=function(){c.show_msg(c.time_string(a))};d.onmouseout=function(){c.show_msg("")};this.minute_lines[a]=d;this.svg.appendChild(d)},init:function(){var b=this;this.div=document.getElementById("timelines_div");this.svg=document.getElementById("timelines_svg");this.msg_div=document.getElementById("timelines_msg");this.zoom_ip=document.getElementById("timelines_zoom");this.h=3;this.w0=1;this.w=this.w0;this.t_max=800;this.marker_radius=3;this.stroke_width=3;this.stroke_colour="#888888";this.correct_colour="#00DD00";this.iffy_colour="#FFA500";this.incorrect_colour="#DD0000";this.active_correct_colour="#006600";this.active_iffy_colour="#886600";this.active_incorrect_colour="#660000";this.data=JSON.parse(this.div.dataset.timelines);this.n=this.data.length;this.attempts=[];for(var c in this.data){var d=this.add_attempt(this.data[c]);this.create_attempt_dom(d)}var a=this.attempts[this.attempts.length-1],e=a.x+10,f=a.y+10;this.svg.width=e;this.svg.height=f;this.svg.style.width=e+"px";this.svg.style.height=f+"px";this.svg.viewBox="0 0 "+e+" "+f;this.minute_lines={};for(var c=60;c<=a.last_step.t;c+=60){this.create_line(c,f)}this.zoom_ip.onchange=function(){b.set_zoom()}},show_msg:function(a){this.msg_div.innerHTML=a},set_zoom:function(){var b=parseFloat(this.zoom_ip.value),d=Math.exp(-.05*b);this.w=this.w0*d;for(var c in this.attempts){var e=this.attempts[c];e.x=e.x0*d;e.bar.setAttributeNS(null,"x2",e.x);for(var a in e.steps){var f=e.steps[a];f.x=f.x0*d;f.marker.setAttributeNS(null,"cx",f.x)}}for(var g in this.minute_lines){var h=this.minute_lines[g];h.setAttributeNS(null,"x1",this.w*g);h.setAttributeNS(null,"x2",this.w*g)}}}});
//# sourceMappingURL=timeline_viewer.min.js.map
